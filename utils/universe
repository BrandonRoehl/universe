#!/usr/bin/env ruby
require 'fileutils'
require "#{$0.chomp('universe')}System"
require "#{$0.chomp('universe')}Compile"

def install
    unless System.universe
        File.symlink(System.pwd, System.sym)
        puts 'Installing universe to system'
        puts 'Make sure that you add'
        puts 'export PATH="$PATH:$HOME/.universe/bin"'
        puts 'to your dotfiles'
    else
        puts 'Universe is already installed'
    end
    compile
end

def update
    system "#{System.universe}/utils/update-modules"
    compile
end

def compile
    FileUtils.rm_r "#{System.sym}/bin"
    FileUtils.mkdir "#{System.sym}/bin"
    FileUtils.symlink('../universe', "#{System.sym}/bin/", force: true)
    for dir in Dir.glob("#{System.sym}/sources/*").select {|f| File.directory? f}
        Compile.all File.basename dir
    end
end

send ARGV[0]
