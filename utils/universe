#!/usr/bin/env ruby
require 'fileutils'
@universe = $0.sub(/\/(bin|utils)\/universe/, '')
require "#{@universe}/utils/Compile"
require "#{@universe}/utils/Logo"

def update
    Logo.credits
    system "#{@universe}/utils/update-modules"
    compile
end

def compile
    FileUtils.rm_rf "#{@universe}/bin"
    FileUtils.mkdir "#{@universe}/bin"
    if ['-o', '--only'].include? ARGV[1]
        @args = ARGV[2..-1]
    else
        for dir in Dir.glob("#{@universe}/sources/*").select {|f| File.directory? f}
            Compile.all dir
        end
        @args = ARGV[1..-1]
    end
    for dir in @args
        Compile.all dir
    end
    FileUtils.symlink('../utils/universe', "#{@universe}/bin/", force: true)
end

send ARGV[0]
